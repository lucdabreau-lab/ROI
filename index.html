<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return on Investment Analysis | Procore Analytics</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Fonts: Importing Inter Tight -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --procore-orange: #D95D2A;
            --procore-black: #1A1A1A;
            --procore-tan: #EAE3D9;
            --procore-offwhite: #F9F7F5;
            --brand-emerald: #10b981;
            --brand-blue: #2563EB;
        }

        body { 
            /* Global Font Update to Inter Tight */
            font-family: 'Inter Tight', sans-serif; 
            background-color: var(--procore-offwhite);
            color: var(--procore-black);
            -webkit-font-smoothing: antialiased;
        }

        /* Sidebar State Styles */
        .tab-active {
            background-color: #fff7ed; /* orange-50 */
            color: var(--procore-orange);
            font-weight: 800;
            border-left: 4px solid var(--procore-orange);
        }
        
        .tab-inactive {
            color: #9ca3af; /* gray-400 */
            font-weight: 500;
            border-left: 4px solid transparent;
        }
        .tab-inactive:hover {
            background-color: #f3f4f6; /* gray-100 */
            color: #374151; /* gray-700 */
        }

        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus { outline: none; }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: var(--procore-tan);
            border-radius: 99px;
        }
        
        input[type=range]::-webkit-slider-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: var(--procore-orange);
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -7px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 2px solid white;
        }
        
        .slider-emerald::-webkit-slider-thumb { background: var(--brand-emerald) !important; }
        .slider-black::-webkit-slider-thumb { background: var(--procore-black) !important; }
        .slider-blue::-webkit-slider-thumb { background: var(--brand-blue) !important; }

        .card-shadow {
            box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
        }

        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            main { padding: 0; max-width: 100%; }
            /* Hide sidebar in print, ensure main content is full width */
            #sidebar-nav { display: none; }
            #main-content-area { width: 100% !important; padding: 0 !important; }
            .card-shadow { box-shadow: none; border: 1px solid #e5e7eb; }
            section { display: block !important; page-break-after: always; }
            #company-name { border: none; background: transparent; padding: 0; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Global Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-6 h-24 flex items-center justify-between">
            <div class="flex items-center gap-6">
                <!-- Branding Container -->
                <div class="flex items-center gap-4 bg-[#F9F7F5] p-2 px-3 rounded-2xl border border-[#EAE3D9]">
                    <div class="group relative h-10 w-24 bg-gray-200 rounded flex items-center justify-center overflow-hidden" title="Paste URL to company logo">
                        <img id="company-logo-img" src="" class="absolute inset-0 h-full w-full object-contain hidden z-0">
                        <input type="text" 
                               id="company-logo-input"
                               class="relative z-10 w-full h-full bg-transparent text-[10px] font-bold text-gray-500 placeholder-gray-500 text-center focus:outline-none focus:bg-white/90 transition-all opacity-100" 
                               placeholder="LOGO LINK" 
                               oninput="updateLogoFromUrl(this)">
                    </div>
                    <div class="w-px h-8 bg-[#EAE3D9]"></div>
                    <img src="https://media.ffycdn.net/us/procore/etmeNi2XofqcS5LaePER.png?width={width}" alt="Procore" class="h-8 w-auto object-contain">
                </div>
                <div class="flex flex-col justify-center">
                    <h1 class="font-black text-xl tracking-tight uppercase leading-none mb-1">Return on Investment</h1>
                    <input type="text" id="company-name" 
                           class="bg-transparent text-xs font-bold text-slate-500 placeholder-slate-400 focus:outline-none focus:border-b focus:border-procore-orange transition-colors w-64 uppercase tracking-widest" 
                           placeholder="ENTER COMPANY NAME" 
                           value="JHL Constructors" 
                           oninput="updateCompanyName(this.value)">
                </div>
            </div>
            
            <button onclick="window.print()" class="bg-slate-900 text-white px-5 py-2.5 rounded-xl font-bold text-sm flex items-center gap-2 hover:bg-black transition-all">
                <i data-lucide="printer" class="w-4 h-4"></i> Export Report
            </button>
        </div>
    </header>

    <!-- Layout Wrapper -->
    <div class="flex flex-col lg:flex-row max-w-7xl mx-auto w-full flex-1 px-6">
        
        <!-- Sidebar Navigation -->
        <nav id="sidebar-nav" class="w-64 hidden lg:flex flex-col gap-2 py-8 pr-6 border-r border-gray-100 sticky top-24 h-[calc(100vh-6rem)] overflow-y-auto no-print">
            <p class="text-[10px] font-bold uppercase text-slate-400 tracking-widest mb-2 pl-4">Value Streams</p>
            
            <button onclick="switchTab('safety')" id="tab-safety" class="text-left px-4 py-3 rounded-xl transition-all text-xs tracking-wide tab-active">
                Incident Reduction
            </button>
            <button onclick="switchTab('rework')" id="tab-rework" class="text-left px-4 py-3 rounded-xl transition-all text-xs tracking-wide tab-inactive">
                Rework Reduction
            </button>
            <button onclick="switchTab('schedule')" id="tab-schedule" class="text-left px-4 py-3 rounded-xl transition-all text-xs tracking-wide tab-inactive">
                GC Overrun Reduction
            </button>
            <button onclick="switchTab('rfi')" id="tab-rfi" class="text-left px-4 py-3 rounded-xl transition-all text-xs tracking-wide tab-inactive">
                RFI Response Reduction
            </button>
            <button onclick="switchTab('coordination')" id="tab-coordination" class="text-left px-4 py-3 rounded-xl transition-all text-xs tracking-wide tab-inactive">
                Coordination Improvement
            </button>
            <button onclick="switchTab('bidder')" id="tab-bidder" class="text-left px-4 py-3 rounded-xl transition-all text-xs tracking-wide tab-inactive">
                Bidder Selection Improvement
            </button>
            
            <div class="my-2 border-t border-gray-100"></div>
            
            <button onclick="switchTab('summary')" id="tab-summary" class="text-left px-4 py-3 rounded-xl transition-all text-xs tracking-wide tab-inactive">
                Executive Summary
            </button>
        </nav>

        <!-- Mobile Nav -->
        <nav class="lg:hidden w-full overflow-x-auto bg-white border-b border-gray-100 p-4 flex gap-4 sticky top-24 z-40 no-print">
             <button onclick="switchTab('safety')" class="whitespace-nowrap px-4 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-700">Incident</button>
             <button onclick="switchTab('rework')" class="whitespace-nowrap px-4 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-700">Rework</button>
             <button onclick="switchTab('schedule')" class="whitespace-nowrap px-4 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-700">Schedule</button>
             <button onclick="switchTab('rfi')" class="whitespace-nowrap px-4 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-700">RFI</button>
             <button onclick="switchTab('coordination')" class="whitespace-nowrap px-4 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-700">Coordination</button>
             <button onclick="switchTab('bidder')" class="whitespace-nowrap px-4 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-700">Bidder</button>
             <button onclick="switchTab('summary')" class="whitespace-nowrap px-4 py-2 bg-gray-100 rounded-lg text-xs font-bold text-gray-700">Summary</button>
        </nav>

        <!-- Main Content Area -->
        <main id="main-content-area" class="flex-1 py-10 pl-0 lg:pl-10">
            
            <!-- Tab 1: Incident Reduction -->
            <section id="content-safety" class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <aside class="lg:col-span-4 space-y-6">
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 card-shadow">
                        <h2 class="text-lg font-bold mb-6 flex items-center gap-2"><i data-lucide="hard-hat" class="w-5 h-5 text-[#D95D2A]"></i> Incident Variables</h2>
                        
                        <div class="space-y-10">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-3 text-sm">Annual Construction Volume</label>
                                <div class="relative rounded-2xl">
                                    <span class="absolute left-5 top-1/2 -translate-y-1/2 text-[#D95D2A] font-bold text-lg">$</span>
                                    <input id="input-annual-volume" type="text" class="w-full pl-10 pr-6 py-4 bg-[#F9F7F5] border border-[#EAE3D9] rounded-2xl focus:border-[#D95D2A] outline-none font-bold text-lg" value="100,000,000" oninput="formatVolumeInput(this)">
                                </div>
                            </div>

                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">Estimated SG&A</label>
                                    <span id="label-sga-pct" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">7%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Typical range of 10% to 12%</p>
                                <input id="input-sga-pct" type="range" min="0.01" max="0.20" step="0.01" value="0.07">
                            </div>

                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">Labor Cost %</label>
                                    <span id="label-labor-pct" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">25%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">25% average for subcontracted. 35% average for self perform</p>
                                <input id="input-labor-pct" type="range" min="0.1" max="0.6" step="0.01" value="0.25">
                            </div>

                            <div class="pt-4 border-t">
                                <div class="flex justify-between items-end mb-4">
                                    <label class="text-sm font-bold text-emerald-700">Safety Improvement</label>
                                    <span id="label-reduction-pct" class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs font-extrabold">10%</span>
                                </div>
                                <input id="input-reduction-pct" type="range" min="0.01" max="0.4" step="0.01" value="0.10" class="slider-emerald">
                            </div>
                        </div>
                    </div>

                    <div class="bg-[#1A1A1A] text-white p-8 rounded-3xl shadow-lg">
                        <div class="flex items-center gap-2 mb-8">
                            <i data-lucide="bar-chart-3" size="18" class="text-[#D95D2A]"></i>
                            <h4 class="text-xs font-black uppercase tracking-widest text-[#D95D2A]">Benchmarks</h4>
                        </div>
                        <div class="space-y-8">
                            <div>
                                <div class="flex justify-between items-end mb-3">
                                    <label class="text-xs font-bold text-[#EAE3D9]">TRIR Benchmark</label>
                                    <span id="label-trir-value" class="text-xs font-black px-2 py-0.5 bg-[#D95D2A] rounded text-white">2.3</span>
                                </div>
                                <input id="input-trir-value" type="range" min="0.5" max="3.0" step="0.1" value="2.3" class="slider-black">
                            </div>
                            <div>
                                <div class="flex justify-between items-end mb-3">
                                    <label class="text-xs font-bold text-[#EAE3D9]">Cost per Recordable</label>
                                    <span id="label-cost-recordable" class="text-xs font-black px-2 py-0.5 bg-[#D95D2A] rounded text-white">$43k</span>
                                </div>
                                <input id="input-cost-recordable" type="range" min="10000" max="90000" step="1000" value="43000" class="slider-black">
                            </div>
                        </div>
                    </div>
                </aside>

                <main class="lg:col-span-8 flex flex-col justify-between">
                    <div class="space-y-8">
                        <div class="bg-emerald-600 rounded-[2.5rem] p-10 text-white relative overflow-hidden shadow-xl">
                            <div class="relative z-10">
                                <p class="text-white/80 font-bold uppercase tracking-widest text-xs mb-2">Target Annual Savings</p>
                                <h2 id="display-annual-savings" class="text-6xl font-black mb-4">$0</h2>
                                <p class="text-white/80 max-w-md text-sm leading-relaxed">
                                    Reducing incident frequency lowers direct insurance liabilities, administrative burden, and lost labor productivity.
                                </p>
                            </div>
                            <i data-lucide="hard-hat" class="absolute right-[-20px] bottom-[-20px] w-64 h-64 text-white/10 rotate-12"></i>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                                <p class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-1">Estimated Field FTEs</p>
                                <p id="display-ftes" class="text-3xl font-black text-slate-800">0</p>
                            </div>
                            <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                                <p class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-1">Predicted Recordables</p>
                                <p id="display-incidents" class="text-3xl font-black text-slate-800">0</p>
                            </div>
                        </div>

                        <div class="bg-white rounded-[2.5rem] border border-slate-200 card-shadow overflow-hidden">
                            <div class="p-8 md:p-12">
                                <h3 class="text-2xl font-black text-[#1A1A1A] mb-12 text-center">Safety ROI Narrative</h3>
                                <div class="space-y-12 relative">
                                    <div class="flex gap-8 items-start relative z-10">
                                        <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">1</div>
                                        <div>
                                            <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">Resource Allocation</h4>
                                            <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                                With an annual volume of <span id="narrative-volume" class="font-bold text-[#D95D2A]">$0</span> and labor allocation of <span id="narrative-labor-pct" class="font-bold text-[#D95D2A]">25%</span>, <span class="company-name-text">JHL Constructors</span> manages approximately <span id="narrative-labor-cost" class="font-bold text-[#D95D2A]">$0</span> in field labor spend.
                                            </p>
                                        </div>
                                    </div>
                                    <div class="flex gap-8 items-start relative z-10">
                                        <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">2</div>
                                        <div>
                                            <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">Liability Exposure</h4>
                                            <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                                Accounting for <span id="narrative-sga-pct" class="font-bold text-[#1A1A1A]">7%</span> overhead and a TRIR of <span id="narrative-trir" class="font-bold text-[#1A1A1A]">2.3</span>, your sites carry an inherent liability of <span id="narrative-total-liability" class="font-black text-[#D95D2A]">$0</span> per year.
                                            </p>
                                        </div>
                                    </div>
                                    <div class="bg-emerald-50 rounded-3xl p-8 border border-emerald-100 flex items-center gap-8 relative z-10">
                                        <div class="p-4 bg-emerald-500 rounded-2xl text-white shadow-lg"><i data-lucide="trending-up" size="32"></i></div>
                                        <div>
                                            <h4 class="text-2xl font-black text-emerald-900 leading-tight">Projected Annual Capture</h4>
                                            <p class="text-emerald-700 mt-1">Driving a <span id="narrative-reduction-pct" class="font-black underline decoration-4 decoration-emerald-200">10%</span> incident reduction recovers:</p>
                                            <div id="narrative-annual-savings" class="text-4xl font-black text-emerald-600 mt-3">$0</div>
                                        </div>
                                    </div>
                                    <div class="absolute left-6 top-6 bottom-32 w-1 bg-[#EAE3D9] -z-0 rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-8 border-t border-slate-200 text-xs text-slate-400 space-y-2">
                        <p class="font-bold uppercase tracking-wider mb-2 text-slate-500">Methodology & References</p>
                        <p><span class="font-bold text-slate-600">Estimated FTEs:</span> Derived from field labor spend. <a href="https://constructioncoverage.com/glossary/labor-burden" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">Construction Coverage Labor Burden</a></p>
                        <p><span class="font-bold text-slate-600">Labor Cost Benchmarks:</span> Average provided by <a href="https://www.ciranalytics.com/clma" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">Construction Labor Market Analyzer</a></p>
                        <p><span class="font-bold text-slate-600">SG&A Benchmarks:</span> <a href="https://cfma.org/articles/cfma-s-2-24-construction-financial-benchmarker-executive-summary" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">CFMA Financial Benchmarker</a></p>
                        <p><span class="font-bold text-slate-600">TRIR Benchmark:</span> Based on industry incidence rates. <a href="https://www.bls.gov/iif/" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">Bureau of Labor Statistics (BLS)</a></p>
                        <p><span class="font-bold text-slate-600">Cost per Recordable:</span> Average cost per medically consulted injury. <a href="https://injuryfacts.nsc.org/work/costs/work-injury-costs/" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">National Safety Council (NSC) Injury Facts</a></p>
                    </div>
                </main>
            </section>

            <!-- Tab 2: Rework Reduction -->
            <section id="content-rework" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-4 space-y-6">
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 card-shadow">
                        <h2 class="text-lg font-bold mb-6 flex items-center gap-2"><i data-lucide="wrench" class="w-5 h-5 text-[#D95D2A]"></i> Rework Variables</h2>
                        <div class="space-y-8">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-3 text-sm">Annual Construction Volume</label>
                                <div class="relative rounded-2xl">
                                    <span class="absolute left-5 top-1/2 -translate-y-1/2 text-[#D95D2A] font-bold text-lg">$</span>
                                    <input id="input-annual-volume-rework" type="text" class="w-full pl-10 pr-6 py-4 bg-[#F9F7F5] border border-[#EAE3D9] rounded-2xl focus:border-[#D95D2A] outline-none font-bold text-lg" value="100,000,000" oninput="formatVolumeInput(this)">
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">Total Rework % of Volume</label>
                                    <span id="val-rw-pct" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">2.5%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">12% average. Ranges from 2% to 20%</p>
                                <input type="range" id="input-rw-pct" min="0.5" max="15" step="0.1" value="2.5">
                        </div>
                        
                        <div>
                            <div class="flex justify-between items-end mb-1">
                                <label class="text-sm font-semibold text-gray-600">Estimated Nonrecoverable Rework</label>
                                <span id="val-rw-non" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">70%</span>
                            </div>
                            <p class="text-xs text-slate-400 mb-3">70% average</p>
                            <input type="range" id="input-rw-non" min="50" max="100" step="5" value="70">
                        </div>
                        
                        <div class="pt-4 border-t">
                            <div class="flex justify-between items-end mb-1">
                                <label class="text-sm font-semibold text-emerald-700">Rework Reduction Target</label>
                                    <span id="val-rw-red" class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs font-extrabold">5.0%</span>
                                </div>
                                <input type="range" id="input-rw-red" min="1" max="25" step="1" value="5.0" class="slider-emerald">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-8 space-y-8">
                    <div class="bg-emerald-600 rounded-[2.5rem] p-10 text-white relative overflow-hidden shadow-xl">
                        <div class="relative z-10">
                            <p class="text-white/80 font-bold uppercase tracking-widest text-xs mb-2">Annual Profit Recovery</p>
                            <h2 id="display-rw-savings" class="text-6xl font-black mb-4">$0</h2>
                            <p class="text-white/80 max-w-md text-sm leading-relaxed">
                                Mitigating direct rework costs through automated QA/QC, real-time field visibility, and integrated coordination workflows.
                            </p>
                        </div>
                        <i data-lucide="trending-up" class="absolute right-[-20px] bottom-[-20px] w-64 h-64 text-white/10 rotate-12"></i>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Liability Exposure</p>
                            <p id="display-rw-exposure" class="text-3xl font-black text-slate-800">$0</p>
                        </div>
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Profit Margin Impact</p>
                            <p id="display-rw-profit" class="text-3xl font-black text-emerald-600">+0.00%</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-[2.5rem] border border-slate-200 card-shadow overflow-hidden">
                        <div class="p-8 md:p-12">
                            <h3 class="text-2xl font-black text-[#1A1A1A] mb-12 text-center">Rework ROI Narrative</h3>
                            <div class="space-y-12 relative">
                                <div class="flex gap-8 items-start relative z-10">
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">1</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">Financial Footprint</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            Based on an annual construction volume of <span id="narrative-rw-vol" class="font-bold text-[#D95D2A]">$0</span> and an estimated rework rate of <span id="narrative-rw-pct" class="font-bold text-[#D95D2A]">2.5%</span>, your total rework volume is approximately <span id="narrative-rw-total" class="font-bold text-[#D95D2A]">$0</span>.
                                        </p>
                                    </div>
                                </div>
                                <div class="flex gap-8 items-start relative z-10">
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">2</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">The Profit Leak</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            Accounting for a <span id="narrative-rw-non" class="font-bold text-[#1A1A1A]">70%</span> nonrecoverable rate, <span class="company-name-text">JHL Constructors</span> absorbs <span id="narrative-rw-exposure" class="font-black text-[#D95D2A]">$0</span> in annual direct profit erosion.
                                        </p>
                                    </div>
                                </div>
                                <div class="bg-emerald-50 rounded-3xl p-8 border border-emerald-100 flex items-center gap-8 relative z-10">
                                    <div class="p-4 bg-emerald-500 rounded-2xl text-white shadow-lg"><i data-lucide="check-circle" size="32"></i></div>
                                    <div>
                                        <h4 class="text-2xl font-black text-emerald-900 leading-tight">Net Capital Recovery</h4>
                                        <p class="text-emerald-700 mt-1">Driving a <span id="narrative-rw-red" class="font-black underline decoration-4 decoration-emerald-200">5%</span> improvement in quality capture recovers:</p>
                                        <div id="narrative-rw-savings" class="text-4xl font-black text-emerald-600 mt-3">$0</div>
                                    </div>
                                </div>
                                <div class="absolute left-6 top-6 bottom-32 w-1 bg-[#EAE3D9] -z-0 rounded-full"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-8 border-t border-slate-200 text-xs text-slate-400 space-y-2">
                        <p class="font-bold uppercase tracking-wider mb-2 text-slate-500">Methodology & References</p>
                        <p><span class="font-bold text-slate-600">Total Rework % of Volume:</span> Benchmarks for rework cost relative to Total Installed Cost. <a href="https://becht.com/becht-blog/entry/measuring-construction-rework-delays-in-sustaining-capital-projects/" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">Becht Engineering Analysis</a></p>
                        <p><span class="font-bold text-slate-600">Estimated Nonrecoverable:</span> Portion of rework costs not recoverable via insurance/back-charges. <a href="https://www.procore.com/ebooks/global-state-of-preconstruction" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">Procore Global State of Preconstruction</a></p>
                    </div>
                </div>
            </section>

            <!-- Tab 3: GC Overrun Reduction -->
            <section id="content-schedule" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-4 space-y-6">
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 card-shadow">
                        <h2 class="text-lg font-bold mb-6 flex items-center gap-2"><i data-lucide="calendar-clock" class="w-5 h-5 text-[#D95D2A]"></i> GC Overrun Variables</h2>
                        <div class="space-y-8">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-3 text-sm">Annual Construction Volume</label>
                                <div class="relative rounded-2xl">
                                    <span class="absolute left-5 top-1/2 -translate-y-1/2 text-[#D95D2A] font-bold text-lg">$</span>
                                    <input id="input-annual-volume-schedule" type="text" class="w-full pl-10 pr-6 py-4 bg-[#F9F7F5] border border-[#EAE3D9] rounded-2xl focus:border-[#D95D2A] outline-none font-bold text-lg" value="100,000,000" oninput="formatVolumeInput(this)">
                                </div>
                            </div>

                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">General Conditions %</label>
                                    <!-- Bubble Style -->
                                    <span id="val-gc-pct" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">8%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Range of 6% to 12%</p>
                                <!-- Fixed ID sync here -->
                                <input type="range" id="input-gc-pct" min="1" max="15" step="0.5" value="8" oninput="syncInputs('input-gc-pct', 'input-rfi-gc-pct')">
                            </div>
                            <div>
                                <div class="flex justify-between items-end mb-2">
                                    <label class="text-sm font-semibold text-gray-600">Avg Project Duration (Mo)</label>
                                    <!-- Bubble Style -->
                                    <span id="val-duration" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">12</span>
                                </div>
                                <!-- Fixed ID sync here -->
                                <input type="range" id="input-duration" min="6" max="36" step="1" value="12" oninput="syncInputs('input-duration', 'input-rfi-duration')">
                        </div>
                        <div>
                            <div class="flex justify-between items-end mb-1">
                                <label class="text-sm font-semibold text-gray-600">Avg Schedule Slippage</label>
                                <!-- Bubble Style -->
                                <span id="val-slippage" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">15%</span>
                            </div>
                            <p class="text-xs text-slate-400 mb-3">72% of projects are delayed 38% on average</p>
                            <!-- Updated step to 1 -->
                            <input type="range" id="input-slippage" min="0" max="50" step="1" value="15">
                        </div>
                        <div class="pt-4 border-t">
                            <div class="flex justify-between items-end mb-2">
                                    <label class="text-sm font-semibold text-emerald-700">Delay Reduction Target</label>
                                    <span id="val-sched-red" class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs font-extrabold">10%</span>
                                </div>
                                <input type="range" id="input-sched-red" min="1" max="30" step="1" value="10" class="slider-emerald">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-8 space-y-6">
                    <div class="bg-emerald-600 rounded-[2.5rem] p-10 text-white relative overflow-hidden">
                        <div class="relative z-10">
                            <p class="text-emerald-100 font-bold uppercase tracking-widest text-xs mb-2">GC Overrun Reduction Savings</p>
                            <h2 id="display-sched-savings" class="text-6xl font-black mb-4">$0</h2>
                            <p class="text-emerald-100/80 max-w-md text-sm leading-relaxed">
                                Proactively mitigating schedule delays reduces the non-reimbursable burn of General Conditions and limits exposure to liquidated damages.
                            </p>
                        </div>
                        <i data-lucide="hourglass" class="absolute right-[-20px] bottom-[-20px] w-64 h-64 text-white/10 rotate-12"></i>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Daily Burn Rate</p>
                            <p id="display-burn-rate" class="text-3xl font-black text-slate-800">$0</p>
                            <p class="text-xs text-slate-400 mt-2">Cost per day of General Conditions</p>
                        </div>
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Total Overrun Liability</p>
                            <p id="display-overrun-cost" class="text-3xl font-black text-[#D95D2A]">$0</p>
                            <p class="text-xs text-slate-400 mt-2">Estimated cost of extending General Conditions</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-[2.5rem] border border-slate-200 card-shadow overflow-hidden">
                        <div class="p-8 md:p-12">
                            <h3 class="text-2xl font-black text-[#1A1A1A] mb-12 text-center">GC Overrun Reduction Narrative</h3>
                            <div class="space-y-12 relative">
                                <div class="flex gap-8 items-start relative z-10">
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">1</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">The Burn Rate</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            With General Conditions set at <span id="narrative-sched-gc-pct" class="font-bold text-[#D95D2A]">8%</span> of your <span id="narrative-sched-vol" class="font-bold text-[#D95D2A]">$100M</span> volume, your project sites burn <span id="narrative-sched-daily-burn" class="font-bold text-[#D95D2A]">$22k</span> every single calendar day.
                                        </p>
                                    </div>
                                </div>
                                <div class="flex gap-8 items-start relative z-10">
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">2</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">The Overrun Risk</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            A typical <span id="narrative-sched-duration" class="font-bold text-[#1A1A1A]">12</span> month project slipping by <span id="narrative-sched-slippage" class="font-bold text-[#1A1A1A]">15%</span> creates an immediate liability of <span id="narrative-sched-overrun" class="font-black text-[#D95D2A]">$1.2M</span> in non-recoverable overhead.
                                        </p>
                                    </div>
                                </div>
                                <div class="bg-emerald-50 rounded-3xl p-8 border border-emerald-100 flex items-center gap-8 relative z-10">
                                    <div class="p-4 bg-emerald-500 rounded-2xl text-white shadow-lg"><i data-lucide="hourglass" size="32"></i></div>
                                    <div>
                                        <h4 class="text-2xl font-black text-emerald-900 leading-tight">Efficiency Dividend</h4>
                                        <p class="text-emerald-700 mt-1">Reducing GC overruns by <span id="narrative-sched-red" class="font-black underline decoration-4 decoration-emerald-200">10%</span> recaptures:</p>
                                        <div id="narrative-sched-savings" class="text-4xl font-black text-emerald-600 mt-3">$0</div>
                                    </div>
                                </div>
                                <div class="absolute left-6 top-6 bottom-32 w-1 bg-[#EAE3D9] -z-0 rounded-full"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-8 border-t border-slate-200 text-xs text-slate-400 space-y-2">
                        <p class="font-bold uppercase tracking-wider mb-2 text-slate-500">Methodology & References</p>
                        <p><span class="font-bold text-slate-600">General Conditions Benchmarks:</span> <a href="https://cfma.org/articles/cfma-s-2-24-construction-financial-benchmarker-executive-summary" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">CFMA Financial Benchmarker</a></p>
                    </div>
                </div>
            </section>

            <!-- Tab 4: RFI Response Reduction -->
            <section id="content-rfi" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-4 space-y-6">
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 card-shadow">
                        <h2 class="text-lg font-bold mb-6 flex items-center gap-2"><i data-lucide="file-text" class="w-5 h-5 text-[#D95D2A]"></i> RFI Variables</h2>
                        <div class="space-y-8">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-3 text-sm">Annual Construction Volume</label>
                                <div class="relative rounded-2xl">
                                    <span class="absolute left-5 top-1/2 -translate-y-1/2 text-[#D95D2A] font-bold text-lg">$</span>
                                    <input id="input-annual-volume-rfi" type="text" class="w-full pl-10 pr-6 py-4 bg-[#F9F7F5] border border-[#EAE3D9] rounded-2xl focus:border-[#D95D2A] outline-none font-bold text-lg" value="100,000,000" oninput="formatVolumeInput(this)">
                                </div>
                            </div>

                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">General Conditions %</label>
                                    <!-- Changed text color to Orange -->
                                    <span id="val-rfi-gc" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">8%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Range of 6% to 12%</p>
                                <!-- Fixed ID, synced -->
                                <input type="range" id="input-rfi-gc-pct" min="1" max="15" step="0.5" value="8" oninput="syncInputs('input-rfi-gc-pct', 'input-gc-pct')">
                            </div>

                            <div>
                                <div class="flex justify-between items-end mb-2">
                                    <label class="text-sm font-semibold text-gray-600">Avg Project Duration (Mo)</label>
                                    <!-- Changed text color to Orange -->
                                    <span id="val-rfi-duration" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">12</span>
                                </div>
                                <!-- Fixed ID, synced -->
                                <input type="range" id="input-rfi-duration" min="6" max="36" step="1" value="12" oninput="syncInputs('input-rfi-duration', 'input-duration')">
                            </div>

                            <!-- NEW: Exposed Hidden RFI Assumption -->
                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">Baseline RFI Frequency</label>
                                    <span id="val-rfi-base-freq" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">10</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Per $1M Volume (Industry Avg: 10)</p>
                                <input type="range" id="input-rfi-base-freq" min="5" max="30" step="1" value="10">
                            </div>
                            <!-- % of Critical Path RFIs -->
                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">% of Critical Path RFIs</label>
                                    <!-- Changed text color to Orange -->
                                    <span id="val-rfi-critical" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">20%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Industry Average Range: 15% to 25%</p>
                                <input type="range" id="input-rfi-critical" min="5" max="30" step="1" value="20">
                            </div>

                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">RFI % from field errors</label>
                                    <!-- Changed text color to Orange -->
                                    <span id="val-rfi-error" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">30%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Industry Average 30%</p>
                                <input type="range" id="input-rfi-error" min="20" max="40" step="1" value="30">
                            </div>

                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">Rework Cost (GC Multiplier)</label>
                                    <!-- Changed text color to Orange -->
                                    <span id="val-rfi-mult" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">10x</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Industry Average is 10x Daily Burn</p>
                                <input type="range" id="input-rfi-mult" min="5" max="15" step="1" value="10">
                            </div>

                            <div class="pt-4 border-t">
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-emerald-700">RFI Reduction Target</label>
                                    <span id="val-rfi-improve" class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs font-extrabold">15%</span>
                                </div>
                                <input type="range" id="input-rfi-improve" min="1" max="50" step="1" value="15" class="slider-emerald">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-8 space-y-6">
                    <div class="bg-emerald-600 rounded-[2.5rem] p-10 text-white relative overflow-hidden shadow-xl">
                        <div class="relative z-10">
                            <p class="text-white/80 font-bold uppercase tracking-widest text-xs mb-2">Critical Path Savings</p>
                            <h2 id="display-rfi-savings" class="text-6xl font-black mb-4">$0</h2>
                            <p class="text-white/80 max-w-md text-sm leading-relaxed">
                                Mitigating field errors and accelerating critical path RFI responses prevents costly rework cycles and compounded schedule delays.
                            </p>
                        </div>
                        <i data-lucide="file-text" class="absolute right-[-20px] bottom-[-20px] w-64 h-64 text-white/10 rotate-12"></i>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Critical Error RFIs</p>
                            <p id="display-rfi-count" class="text-3xl font-black text-slate-800">0</p>
                            <p class="text-xs text-slate-400 mt-2">Est. annual RFIs driving delay/rework</p>
                        </div>
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Est. Rework Cost per Impact</p>
                            <!-- Changed Violet to Orange -->
                            <p id="display-rfi-burden" class="text-3xl font-black text-[#D95D2A]">$0</p>
                            <p class="text-xs text-slate-400 mt-2">10x Daily Burn Rate</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-[2.5rem] border border-slate-200 card-shadow overflow-hidden">
                        <div class="p-8 md:p-12">
                            <h3 class="text-2xl font-black text-[#1A1A1A] mb-12 text-center">RFI Impact Narrative</h3>
                            <div class="space-y-12 relative">
                                <div class="flex gap-8 items-start relative z-10">
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">1</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">The Critical Few</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            Assuming <span id="narrative-rfi-error" class="font-bold text-[#D95D2A]">30%</span> of RFIs stem from field errors and <span id="narrative-rfi-critical" class="font-bold text-[#D95D2A]">20%</span> of those impact the critical path, <span class="company-name-text">JHL Constructors</span> faces approx. <span id="narrative-rfi-count" class="font-bold text-[#D95D2A]">0</span> high-impact events annually.
                                        </p>
                                    </div>
                                </div>
                                <div class="flex gap-8 items-start relative z-10">
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">2</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">Cost of Delay</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            With a daily GC burn of <span id="narrative-rfi-burn" class="font-bold text-[#1A1A1A]">$0</span>, a single rework event costs <span id="narrative-rfi-mult" class="font-bold text-[#1A1A1A]">10x</span> that rate, totaling <span id="narrative-rfi-cost" class="font-black text-[#D95D2A]">$0</span> per incident in lost time and remediation.
                                        </p>
                                    </div>
                                </div>
                                <div class="bg-emerald-50 rounded-3xl p-8 border border-emerald-100 flex items-center gap-8 relative z-10">
                                    <div class="p-4 bg-emerald-500 rounded-2xl text-white shadow-lg"><i data-lucide="clock" size="32"></i></div>
                                    <div>
                                        <h4 class="text-2xl font-black text-emerald-900 leading-tight">Field Efficiency</h4>
                                        <p class="text-emerald-700 mt-1">Reducing these critical gaps by <span id="narrative-rfi-improve" class="font-black underline decoration-4 decoration-emerald-200">15%</span> saves:</p>
                                        <div id="narrative-rfi-savings" class="text-4xl font-black text-emerald-600 mt-3">$0</div>
                                    </div>
                                </div>
                                <div class="absolute left-6 top-6 bottom-32 w-1 bg-[#EAE3D9] -z-0 rounded-full"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-8 border-t border-slate-200 text-xs text-slate-400 space-y-2">
                        <p class="font-bold uppercase tracking-wider mb-2 text-slate-500">Methodology & References</p>
                        <p><span class="font-bold text-slate-600">Cost of Quality:</span> <a href="https://asq.org/quality-resources/cost-of-quality" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">ASQ Cost of Quality</a></p>
                        <p><span class="font-bold text-slate-600">1-10-100 Rule:</span> <a href="https://aljamouss.com/en/details/149/What-is-the-1-10-100-Rule-#:~:text=%24100%3A%20Bad%20data%20may%20flow,To%20summarize" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">The 1-10-100 Rule</a></p>
                        <p><span class="font-bold text-slate-600">RFI Cost Analysis:</span> <a href="https://www.constructionjunkie.com/blog/2015/9/7/the-cost-of-rfis-and-best-practices-for-construction-professionals#:~:text=The%20Navigant%20Construction%20Forum%20and,The%20group%20analyzed%20over%201%2C300" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">Navigant Construction Forum (Construction Junkie)</a></p>
                        <p><span class="font-bold text-slate-600">Delay Claims:</span> AACE International Recommended Practice No. 38R-06: "Documenting Evidence for Delay Claims."</p>
                    </div>
                </div>
            </section>

            <!-- Tab 5: Coordination Improvement -->
            <section id="content-coordination" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-4 space-y-6">
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 card-shadow">
                        <h2 class="text-lg font-bold mb-6 flex items-center gap-2"><i data-lucide="scan-search" class="w-5 h-5 text-[#D95D2A]"></i> Coordination Variables</h2>
                        <div class="space-y-8">
                            
                            <!-- Synced Volume Input -->
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-3 text-sm">Annual Construction Volume</label>
                                <div class="relative rounded-2xl">
                                    <span class="absolute left-5 top-1/2 -translate-y-1/2 text-[#D95D2A] font-bold text-lg">$</span>
                                    <input id="input-annual-volume-coord" type="text" class="w-full pl-10 pr-6 py-4 bg-[#F9F7F5] border border-[#EAE3D9] rounded-2xl focus:border-[#D95D2A] outline-none font-bold text-lg" value="100,000,000" oninput="formatVolumeInput(this)">
                                </div>
                            </div>

                            <!-- Clash Detection Savings Target -->
                            <div class="pt-4 border-t">
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-emerald-700">Clash Detection Savings %</label>
                                    <span id="val-coord-improve" class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs font-extrabold">5.00%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Up to 10%</p>
                                <input type="range" id="input-coord-improve" min="0" max="10" step="0.25" value="5" class="slider-emerald">
                            </div>

                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-8 space-y-6">
                    <!-- Hero Card -->
                    <div class="bg-emerald-600 rounded-[2.5rem] p-10 text-white relative overflow-hidden shadow-xl">
                        <div class="relative z-10">
                            <p class="text-white/80 font-bold uppercase tracking-widest text-xs mb-2">Coordination Savings</p>
                            <h2 id="display-coord-savings" class="text-6xl font-black mb-4">$0</h2>
                            <p class="text-white/80 max-w-md text-sm leading-relaxed">
                                Proactive clash detection and resolution prior to construction prevents significant rework costs, schedule delays, and field conflicts.
                            </p>
                        </div>
                        <i data-lucide="scan-search" class="absolute right-[-20px] bottom-[-20px] w-64 h-64 text-white/10 rotate-12"></i>
                    </div>

                    <!-- Secondary Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Target Efficiency Gain</p>
                            <p id="display-coord-improve-pct" class="text-3xl font-black text-slate-800">0.00%</p>
                            <p class="text-xs text-slate-400 mt-2">Reduction in overall project cost</p>
                        </div>
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Projected Value</p>
                            <p id="display-coord-val" class="text-3xl font-black text-[#D95D2A]">$0</p>
                            <p class="text-xs text-slate-400 mt-2">Based on Annual Volume</p>
                        </div>
                    </div>

                    <!-- Narrative -->
                    <div class="bg-white rounded-[2.5rem] border border-slate-200 card-shadow overflow-hidden">
                        <div class="p-8 md:p-12">
                            <h3 class="text-2xl font-black text-[#1A1A1A] mb-12 text-center">Coordination Narrative</h3>
                            <div class="space-y-12 relative">
                                <!-- Step 1 -->
                                <div class="flex gap-8 items-start relative z-10">
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">1</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">VDC Opportunity</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            For an annual volume of <span id="narrative-coord-vol" class="font-bold text-[#D95D2A]">$100M</span>, implementing Virtual Design and Construction (VDC) provides a mechanism to identify constructability issues before they reach the field.
                                        </p>
                                    </div>
                                </div>
                                <!-- Step 2 -->
                                <div class="flex gap-8 items-start relative z-10">
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">2</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">Industry Benchmark</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            ASCE research indicates that effective clash detection and coordination can yield direct savings of up to <span class="font-bold text-[#D95D2A]">10%</span> of the contract value by avoiding rework and change orders.
                                        </p>
                                    </div>
                                </div>
                                <!-- Step 3 -->
                                <div class="bg-emerald-50 rounded-3xl p-8 border border-emerald-100 flex items-center gap-8 relative z-10">
                                    <div class="p-4 bg-emerald-500 rounded-2xl text-white shadow-lg"><i data-lucide="check-circle" size="32"></i></div>
                                    <div>
                                        <h4 class="text-2xl font-black text-emerald-900 leading-tight">VDC ROI</h4>
                                        <p class="text-emerald-700 mt-1">Applying a target efficiency gain of <span id="narrative-coord-improve" class="font-black underline decoration-4 decoration-emerald-200">5.00%</span> yields:</p>
                                        <div id="narrative-coord-savings" class="text-4xl font-black text-emerald-600 mt-3">$0</div>
                                    </div>
                                </div>
                                <div class="absolute left-6 top-6 bottom-32 w-1 bg-[#EAE3D9] -z-0 rounded-full"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Footnotes -->
                    <div class="mt-8 pt-8 border-t border-slate-200 text-xs text-slate-400 space-y-2">
                        <p class="font-bold uppercase tracking-wider mb-2 text-slate-500">Methodology & References</p>
                        <p>
                            <span class="font-bold text-slate-600">ROI of BIM/Clash Detection:</span> 
                            <a href="https://ascelibrary.org/doi/10.1061/%28ASCE%29LM.1943-5630.0000127#core-collateral-c10" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">ASCE Library - ROI of BIM for Clash Detection</a>
                        </p>
                    </div>
                </div>
            </section>

            <!-- Tab 6: Bidder Selection Improvement -->
            <section id="content-bidder" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-4 space-y-6">
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 card-shadow">
                        <h2 class="text-lg font-bold mb-6 flex items-center gap-2"><i data-lucide="users" class="w-5 h-5 text-[#D95D2A]"></i> Bidder Variables</h2>
                        <div class="space-y-8">
                            
                            <!-- Synced Volume Input -->
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-3 text-sm">Annual Construction Volume</label>
                                <div class="relative rounded-2xl">
                                    <!-- Changed $ color and focus border to Orange -->
                                    <span class="absolute left-5 top-1/2 -translate-y-1/2 text-[#D95D2A] font-bold text-lg">$</span>
                                    <input id="input-annual-volume-bidder" type="text" class="w-full pl-10 pr-6 py-4 bg-[#F9F7F5] border border-[#EAE3D9] rounded-2xl focus:border-[#D95D2A] outline-none font-bold text-lg" value="100,000,000" oninput="formatVolumeInput(this)">
                                </div>
                            </div>

                            <!-- Low Bidder Selection -->
                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">Low Bidder Selection %</label>
                                    <!-- Bubble Style -->
                                    <span id="val-bid-low" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">50%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">50% Average</p>
                                <input type="range" id="input-bid-low" min="25" max="100" step="5" value="50">
                            </div>

                            <!-- Project Dispute Frequency -->
                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <!-- Renamed to Frequency -->
                                    <label class="text-sm font-semibold text-gray-600">Project Dispute Frequency</label>
                                    <!-- Bubble Style -->
                                    <span id="val-bid-dispute" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">70%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">70% Average</p>
                                <input type="range" id="input-bid-dispute" min="0" max="100" step="5" value="70">
                            </div>

                            <!-- Initial Dispute Value -->
                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">Initial Dispute Value %</label>
                                    <!-- Bubble Style -->
                                    <span id="val-bid-initial" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">8%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Average 8% of Project Value</p>
                                <input type="range" id="input-bid-initial" min="1" max="20" step="0.5" value="8">
                            </div>

                            <!-- Recovery Rate -->
                            <div>
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-gray-600">Recovery Rate %</label>
                                    <!-- Bubble Style -->
                                    <span id="val-bid-recover" class="px-3 py-1 bg-[#EAE3D9] text-[#D95D2A] rounded-full text-xs font-extrabold">50%</span>
                                </div>
                                <p class="text-xs text-slate-400 mb-3">Average 50% of Initial Dispute Value</p>
                                <input type="range" id="input-bid-recover" min="0" max="100" step="5" value="50">
                            </div>

                            <!-- Improvement Target -->
                            <div class="pt-4 border-t">
                                <div class="flex justify-between items-end mb-1">
                                    <label class="text-sm font-semibold text-emerald-700">Bidder Selection Improvement</label>
                                    <span id="val-bid-improve" class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs font-extrabold">10%</span>
                                </div>
                                <input type="range" id="input-bid-improve" min="1" max="30" step="1" value="10" class="slider-emerald">
                            </div>

                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-8 space-y-6">
                    <!-- Hero Card -->
                    <div class="bg-emerald-600 rounded-[2.5rem] p-10 text-white relative overflow-hidden shadow-xl">
                        <div class="relative z-10">
                            <p class="text-white/80 font-bold uppercase tracking-widest text-xs mb-2">Dispute Avoidance Savings</p>
                            <h2 id="display-bid-savings" class="text-6xl font-black mb-4">$0</h2>
                            <p class="text-white/80 max-w-md text-sm leading-relaxed">
                                Improving bidder selection criteria reduces the frequency of low-performing subcontractors, mitigating downstream dispute costs and settlement liabilities.
                            </p>
                        </div>
                        <i data-lucide="users" class="absolute right-[-20px] bottom-[-20px] w-64 h-64 text-white/10 rotate-12"></i>
                    </div>

                    <!-- Secondary Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Total Dispute Exposure</p>
                            <p id="display-bid-exposure" class="text-3xl font-black text-slate-800">$0</p>
                        </div>
                        <div class="bg-white p-8 rounded-2xl border border-slate-200 card-shadow text-center">
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Settlement Liability</p>
                            <p id="display-bid-liability" class="text-3xl font-black text-emerald-600">$0</p>
                            <!-- Updated explanation for transparency -->
                            <p class="text-xs text-slate-400 mt-2">Dispute Exposure  (1 - Recovery Rate)</p>
                        </div>
                    </div>

                    <!-- Narrative -->
                    <div class="bg-white rounded-[2.5rem] border border-slate-200 card-shadow overflow-hidden">
                        <div class="p-8 md:p-12">
                            <h3 class="text-2xl font-black text-[#1A1A1A] mb-12 text-center">Bidder Selection Narrative</h3>
                            <div class="space-y-12 relative">
                                <!-- Step 1 -->
                                <div class="flex gap-8 items-start relative z-10">
                                    <!-- Changed text-blue-600 to text-[#D95D2A] -->
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">1</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">The Low Bid Risk</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            With <span id="narrative-bid-low" class="font-bold text-[#D95D2A]">50%</span> of volume awarded to low bidders and a <span id="narrative-bid-freq" class="font-bold text-[#D95D2A]">70%</span> dispute frequency, <span class="company-name-text">JHL Constructors</span> faces high exposure to performance-based claims.
                                        </p>
                                    </div>
                                </div>
                                <!-- Step 2 -->
                                <div class="flex gap-8 items-start relative z-10">
                                    <!-- Changed text-blue-600 to text-[#D95D2A] -->
                                    <div class="w-12 h-12 bg-white rounded-2xl border-2 border-[#EAE3D9] flex items-center justify-center font-black text-[#D95D2A] shrink-0 shadow-sm">2</div>
                                    <div>
                                        <h4 class="font-black text-[#1A1A1A] text-lg uppercase tracking-tight">Cost of Conflict</h4>
                                        <p class="text-slate-500 mt-2 leading-relaxed max-w-lg">
                                            Initial disputes could total <span id="narrative-bid-initial" class="font-bold text-[#1A1A1A]">$0</span> annually. Factoring in a <span id="narrative-bid-recover" class="font-bold text-[#1A1A1A]">50%</span> recovery rate, the direct bottom-line hit is estimated at <span id="narrative-bid-settle-val" class="font-black text-[#D95D2A]">$0</span> per year.
                                        </p>
                                    </div>
                                </div>
                                <!-- Step 3 -->
                                <div class="bg-emerald-50 rounded-3xl p-8 border border-emerald-100 flex items-center gap-8 relative z-10">
                                    <div class="p-4 bg-emerald-500 rounded-2xl text-white shadow-lg"><i data-lucide="shield-check" size="32"></i></div>
                                    <div>
                                        <h4 class="text-2xl font-black text-emerald-900 leading-tight">Selection Value</h4>
                                        <p class="text-emerald-700 mt-1">Improving selection criteria by <span id="narrative-bid-improve" class="font-black underline decoration-4 decoration-emerald-200">10%</span> avoids:</p>
                                        <div id="narrative-bid-savings" class="text-4xl font-black text-emerald-600 mt-3">$0</div>
                                    </div>
                                </div>
                                <div class="absolute left-6 top-6 bottom-32 w-1 bg-[#EAE3D9] -z-0 rounded-full"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Footnotes -->
                    <div class="mt-8 pt-8 border-t border-slate-200 text-xs text-slate-400 space-y-2">
                        <p class="font-bold uppercase tracking-wider mb-2 text-slate-500">Methodology & References</p>
                        <p>
                            <span class="font-bold text-slate-600">Dispute Frequency:</span>
                            <a href="https://www.nationalacademies.org/read/11846/chapter/9" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">National Academies</a>
                        </p>
                        <p>
                            <span class="font-bold text-slate-600">Design-Build Effectiveness:</span>
                            <a href="https://www.fhwa.dot.gov/reports/designbuild/designbuild.pdf" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">FHWA Design-Build Report</a>
                        </p>
                        <p>
                            <span class="font-bold text-slate-600">Claim Recovery Rates:</span>
                            <a href="https://www.nationalacademies.org/read/11846/chapter/9" target="_blank" class="underline hover:text-[#D95D2A] transition-colors">National Academies (Chapter 9)</a>
                        </p>
                    </div>
                </div>
            </section>

            <!-- Tab 7: Executive Summary -->
            <section id="content-summary" class="hidden space-y-8">
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-4 mb-4 bg-white p-6 rounded-3xl border border-slate-200 card-shadow w-full max-w-5xl mx-auto no-print">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggle-safety" class="sr-only peer" checked onchange="calculate(); renderChart();">
                        <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#D95D2A]"></div>
                        <span class="ms-3 text-sm font-bold text-gray-700">Incident Reduction</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggle-rework" class="sr-only peer" checked onchange="calculate(); renderChart();">
                        <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#1A1A1A]"></div>
                        <span class="ms-3 text-sm font-bold text-gray-700">Rework Reduction</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggle-schedule" class="sr-only peer" checked onchange="calculate(); renderChart();">
                        <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#EAE3D9]"></div>
                        <span class="ms-3 text-sm font-bold text-gray-700">GC Overrun Reduction</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggle-rfi" class="sr-only peer" checked onchange="calculate(); renderChart();">
                        <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#8d6e5b]"></div>
                        <span class="ms-3 text-sm font-bold text-gray-700">RFI Response Reduction</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggle-coordination" class="sr-only peer" checked onchange="calculate(); renderChart();">
                        <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#cec4a1]"></div>
                        <span class="ms-3 text-sm font-bold text-gray-700">Coordination Improvement</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggle-bidder" class="sr-only peer" checked onchange="calculate(); renderChart();">
                        <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#566578]"></div>
                        <span class="ms-3 text-sm font-bold text-gray-700">Bidder Selection Improvement</span>
                    </label>
                </div>

                <!-- Investment Inputs (New) -->
                <div class="bg-white p-6 rounded-3xl border border-slate-200 card-shadow max-w-4xl mx-auto">
                    <h4 class="text-xs font-black uppercase tracking-widest text-slate-400 mb-4"><span class="company-name-text">JHL Constructors</span> Investment</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">Annual Software Investment</label>
                            <div class="relative rounded-xl">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">$</span>
                                <input id="input-invest-annual" type="text" class="w-full pl-8 pr-4 py-3 bg-[#F9F7F5] border border-[#EAE3D9] rounded-xl focus:border-[#D95D2A] outline-none font-bold text-slate-700" value="50,000" oninput="formatCurrencyInput(this)">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-700 mb-2">One-Time Professional Services</label>
                            <div class="relative rounded-xl">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">$</span>
                                <input id="input-invest-onetime" type="text" class="w-full pl-8 pr-4 py-3 bg-[#F9F7F5] border border-[#EAE3D9] rounded-xl focus:border-[#D95D2A] outline-none font-bold text-slate-700" value="10,000" oninput="formatCurrencyInput(this)">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 card-shadow text-center">
                        <p class="text-xs font-bold text-gray-400 uppercase mb-2">Total Year 1 Realization</p>
                        <h3 id="summary-total-savings" class="text-4xl font-black text-[#D95D2A]">$0</h3>
                    </div>
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 card-shadow text-center">
                        <p class="text-xs font-bold text-gray-400 uppercase mb-2">Year 1 ROI</p>
                        <!-- Changed text color to emerald (green) -->
                        <h3 id="summary-roi-y1" class="text-4xl font-black text-emerald-600">0%</h3>
                    </div>
                    <div class="bg-white p-8 rounded-3xl border border-slate-200 card-shadow text-center">
                        <p class="text-xs font-bold text-gray-400 uppercase mb-2">3-Year Cumulative Value</p>
                        <h3 id="summary-total-3yr" class="text-4xl font-black text-emerald-600">$0</h3>
                    </div>
                </div>
                <div class="bg-white p-10 rounded-3xl border border-slate-200 card-shadow">
                    <h3 class="text-xl font-bold mb-8">Value Realization Growth Projection</h3>
                    <div class="h-96"><canvas id="roiChart"></canvas></div>
                </div>
            </section>

        </main>
    </div>

    <script>
        // Utilities
        const toCurrency = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(val);
        const toShort = (val) => val >= 1e6 ? '$' + (val/1e6).toFixed(1) + 'M' : val >= 1e3 ? '$' + Math.round(val/1e3) + 'k' : '$' + val;

        let roiChart = null;
        const state = { safety: 0, rework: 0, schedule: 0, rfi: 0, coordination: 0, bidder: 0, roi: [0,0,0] };

        function switchTab(tab) {
            const tabs = ['safety', 'rework', 'schedule', 'rfi', 'coordination', 'bidder', 'summary'];
            
            tabs.forEach(t => {
                const content = document.getElementById(`content-${t}`);
                const tabBtn = document.getElementById(`tab-${t}`);
                
                if (content) content.classList.add('hidden');
                if (tabBtn) tabBtn.className = 'text-left px-4 py-3 rounded-xl transition-all text-xs tracking-wide tab-inactive';
            });
            
            const activeContent = document.getElementById(`content-${tab}`);
            const activeTab = document.getElementById(`tab-${tab}`);
            
            if (activeContent) activeContent.classList.remove('hidden');
            if (activeTab) activeTab.className = 'text-left px-4 py-3 rounded-xl transition-all text-xs tracking-wide tab-active';
            
            if (tab === 'summary') renderChart();
        }

        // Modified function to sync volume inputs across all tabs
        function formatVolumeInput(input) {
            let rawValue = input.value.replace(/\D/g, '');
            if (rawValue === '') {
                calculate();
                return;
            }
            const formatted = Number(rawValue).toLocaleString();
            
            const volInputs = [
                document.getElementById('input-annual-volume'),
                document.getElementById('input-annual-volume-rework'),
                document.getElementById('input-annual-volume-schedule'),
                document.getElementById('input-annual-volume-rfi'),
                document.getElementById('input-annual-volume-coord'),
                document.getElementById('input-annual-volume-bidder')
            ];
            
            volInputs.forEach(el => {
                if (el && el !== input) {
                    el.value = formatted;
                }
            });

            input.value = formatted;
            calculate();
        }

        // Generic currency formatter for investment inputs (no syncing)
        function formatCurrencyInput(input) {
            let rawValue = input.value.replace(/\D/g, '');
            if (rawValue === '') {
                calculate();
                renderChart(); 
                return;
            }
            input.value = Number(rawValue).toLocaleString();
            calculate();
            renderChart();
        }

        // Update company name text throughout dashboard
        function updateCompanyName(name) {
            const companyName = name.trim() || 'The Company';
            document.querySelectorAll('.company-name-text').forEach(el => {
                el.innerText = companyName;
            });
        }

        // Handle logo URL input
        function updateLogoFromUrl(input) {
            const url = input.value.trim();
            const img = document.getElementById('company-logo-img');
            
            if (url.length > 5) { 
                img.src = url;
                img.onerror = function() {
                    img.classList.add('hidden');
                    input.classList.remove('opacity-0', 'hover:opacity-100', 'focus:opacity-100');
                };
                img.onload = function() {
                    img.classList.remove('hidden');
                    input.classList.add('opacity-0', 'hover:opacity-100', 'focus:opacity-100');
                };
            } else {
                img.classList.add('hidden');
                input.classList.remove('opacity-0', 'hover:opacity-100', 'focus:opacity-100');
            }
        }

        // NEW: Sync function for shared inputs (GC & Duration)
        function syncInputs(sourceId, targetId) {
            const el = document.getElementById(sourceId);
            if (!el) return;
            const val = el.value;
            
            const base = document.getElementById(targetId);
            if(base) base.value = val;
            
            const rfi = document.getElementById(targetId.replace('input-', 'input-rfi-'));
            if(rfi) rfi.value = val;
            
            const rfiPct = document.getElementById(targetId.replace('input-gc-pct', 'input-rfi-gc-pct'));
             if(rfiPct) rfiPct.value = val;
             
             // Also handle Duration Sync
             const rfiDur = document.getElementById(targetId.replace('input-duration', 'input-rfi-duration'));
             if(rfiDur) rfiDur.value = val;

            calculate();
        }

        function calculate() {
            // Helper to safely get value from an input ID, defaulting to 0 if missing or empty
            const getVal = (id) => {
                const el = document.getElementById(id);
                if (!el) return 0;
                // Clean commas if present
                return parseFloat(el.value.replace(/,/g, '')) || 0;
            };

            // Safe volume retrieval (handles commas and missing elements)
            let vol = 0;
            const volInput1 = document.getElementById('input-annual-volume');
            if (volInput1) {
                vol = parseFloat(volInput1.value.replace(/,/g, '')) || 0;
            } else {
                // Fallback scan
                const ids = ['input-annual-volume-rework', 'input-annual-volume-schedule', 'input-annual-volume-rfi', 'input-annual-volume-coord', 'input-annual-volume-bidder'];
                for (let id of ids) {
                    const el = document.getElementById(id);
                    if (el) {
                        vol = parseFloat(el.value.replace(/,/g, '')) || 0;
                        break;
                    }
                }
            }

            // --- Safety Logic ---
            const sgaPct = getVal('input-sga-pct');
            const lPct = getVal('input-labor-pct');
            const safetyRed = getVal('input-reduction-pct');
            const trir = getVal('input-trir-value');
            const costPerRecordable = getVal('input-cost-recordable');
            
            const totalLaborCost = vol * lPct;
            const fieldLaborSpend = totalLaborCost * (1 - sgaPct);
            const ftes = fieldLaborSpend / 100800;
            const incidents = (ftes / 100) * trir;
            const safetyLiability = incidents * costPerRecordable;
            state.safety = safetyLiability * safetyRed;

            // UI Updates - Safety
            if (document.getElementById('label-sga-pct')) document.getElementById('label-sga-pct').innerText = Math.round(sgaPct * 100) + '%';
            if (document.getElementById('label-labor-pct')) document.getElementById('label-labor-pct').innerText = Math.round(lPct * 100) + '%';
            if (document.getElementById('label-reduction-pct')) document.getElementById('label-reduction-pct').innerText = Math.round(safetyRed * 100) + '%';
            if (document.getElementById('label-trir-value')) document.getElementById('label-trir-value').innerText = trir.toFixed(1);
            if (document.getElementById('label-cost-recordable')) document.getElementById('label-cost-recordable').innerText = toShort(costPerRecordable);
            
            if (document.getElementById('display-annual-savings')) document.getElementById('display-annual-savings').innerText = toCurrency(state.safety);
            if (document.getElementById('display-ftes')) document.getElementById('display-ftes').innerText = Math.round(ftes).toLocaleString();
            if (document.getElementById('display-incidents')) document.getElementById('display-incidents').innerText = incidents.toFixed(1);
            
            if (document.getElementById('narrative-volume')) document.getElementById('narrative-volume').innerText = toCurrency(vol);
            if (document.getElementById('narrative-labor-pct')) document.getElementById('narrative-labor-pct').innerText = Math.round(lPct * 100) + '%';
            if (document.getElementById('narrative-labor-cost')) document.getElementById('narrative-labor-cost').innerText = toCurrency(totalLaborCost);
            if (document.getElementById('narrative-sga-pct')) document.getElementById('narrative-sga-pct').innerText = Math.round(sgaPct * 100) + '%';
            if (document.getElementById('narrative-trir')) document.getElementById('narrative-trir').innerText = trir.toFixed(1);
            if (document.getElementById('narrative-total-liability')) document.getElementById('narrative-total-liability').innerText = toCurrency(safetyLiability);
            if (document.getElementById('narrative-reduction-pct')) document.getElementById('narrative-reduction-pct').innerText = Math.round(safetyRed * 100) + '%';
            if (document.getElementById('narrative-annual-savings')) document.getElementById('narrative-annual-savings').innerText = toCurrency(state.safety);

            // --- Rework Logic ---
            const rwPct = getVal('input-rw-pct') / 100;
            const rwNon = getVal('input-rw-non') / 100;
            const rwRed = getVal('input-rw-red') / 100;
            
            const totalReworkExposure = (vol * rwPct) * rwNon;
            state.rework = totalReworkExposure * rwRed;

            if (document.getElementById('val-rw-pct')) document.getElementById('val-rw-pct').innerText = (rwPct * 100).toFixed(1) + '%';
            if (document.getElementById('val-rw-non')) document.getElementById('val-rw-non').innerText = Math.round(rwNon * 100) + '%';
            if (document.getElementById('val-rw-red')) document.getElementById('val-rw-red').innerText = (rwRed * 100).toFixed(1) + '%';
            
            if (document.getElementById('display-rw-savings')) document.getElementById('display-rw-savings').innerText = toCurrency(state.rework);
            if (document.getElementById('display-rw-exposure')) document.getElementById('display-rw-exposure').innerText = toCurrency(totalReworkExposure);
            if (document.getElementById('display-rw-profit')) document.getElementById('display-rw-profit').innerText = '+' + (vol > 0 ? ((state.rework / vol) * 100).toFixed(2) : '0.00') + '%';

            if (document.getElementById('narrative-rw-vol')) document.getElementById('narrative-rw-vol').innerText = toCurrency(vol);
            if (document.getElementById('narrative-rw-pct')) document.getElementById('narrative-rw-pct').innerText = (rwPct * 100).toFixed(1) + '%';
            if (document.getElementById('narrative-rw-total')) document.getElementById('narrative-rw-total').innerText = toCurrency(vol * rwPct);
            if (document.getElementById('narrative-rw-non')) document.getElementById('narrative-rw-non').innerText = Math.round(rwNon * 100) + '%';
            if (document.getElementById('narrative-rw-exposure')) document.getElementById('narrative-rw-exposure').innerText = toCurrency(totalReworkExposure);
            if (document.getElementById('narrative-rw-red')) document.getElementById('narrative-rw-red').innerText = (rwRed * 100).toFixed(1) + '%';
            if (document.getElementById('narrative-rw-savings')) document.getElementById('narrative-rw-savings').innerText = toCurrency(state.rework);

            // --- Schedule Logic ---
            const gcPct = getVal('input-gc-pct') / 100;
            const durationMo = getVal('input-duration');
            const slippagePct = getVal('input-slippage') / 100;
            const schedRed = getVal('input-sched-red') / 100;

            const totalGcCost = vol * gcPct;
            const durationDays = durationMo * 30; // Approx
            const dailyBurn = durationDays > 0 ? totalGcCost / durationDays : 0;
            
            const overrunDays = durationDays * slippagePct;
            const overrunCost = overrunDays * dailyBurn;
            
            // Removed Claim Risk Calculation entirely per request
            // const claimExposure = vol * 0.02 * 0.257; 
            
            const totalScheduleExposure = overrunCost; // Was overrunCost + claimExposure
            state.schedule = totalScheduleExposure * schedRed;

            // Schedule UI
            if (document.getElementById('val-gc-pct')) document.getElementById('val-gc-pct').innerText = (gcPct * 100).toFixed(1) + '%';
            if (document.getElementById('val-duration')) document.getElementById('val-duration').innerText = durationMo;
            if (document.getElementById('val-slippage')) document.getElementById('val-slippage').innerText = (slippagePct * 100).toFixed(0) + '%';
            if (document.getElementById('val-sched-red')) document.getElementById('val-sched-red').innerText = (schedRed * 100).toFixed(0) + '%';
            
            if (document.getElementById('display-sched-savings')) document.getElementById('display-sched-savings').innerText = toCurrency(state.schedule);
            if (document.getElementById('display-burn-rate')) document.getElementById('display-burn-rate').innerText = toCurrency(dailyBurn);
            if (document.getElementById('display-overrun-cost')) document.getElementById('display-overrun-cost').innerText = toCurrency(totalScheduleExposure);

            // Narrative Update for Schedule
            if (document.getElementById('narrative-sched-vol')) document.getElementById('narrative-sched-vol').innerText = toShort(vol);
            if (document.getElementById('narrative-sched-gc-pct')) document.getElementById('narrative-sched-gc-pct').innerText = (gcPct * 100).toFixed(1) + '%';
            if (document.getElementById('narrative-sched-daily-burn')) document.getElementById('narrative-sched-daily-burn').innerText = toCurrency(dailyBurn);
            if (document.getElementById('narrative-sched-duration')) document.getElementById('narrative-sched-duration').innerText = durationMo;
            if (document.getElementById('narrative-sched-slippage')) document.getElementById('narrative-sched-slippage').innerText = (slippagePct * 100).toFixed(0) + '%';
            if (document.getElementById('narrative-sched-overrun')) document.getElementById('narrative-sched-overrun').innerText = toCurrency(overrunCost); // Narrative focused on direct overrun
            if (document.getElementById('narrative-sched-red')) document.getElementById('narrative-sched-red').innerText = (schedRed * 100).toFixed(0) + '%';
            if (document.getElementById('narrative-sched-savings')) document.getElementById('narrative-sched-savings').innerText = toCurrency(state.schedule);

            // --- RFI Logic (UPDATED) ---
            // Inputs from Tab 4 (some synced from Tab 3 logic)
            // Note: gcPct and durationMo are already derived from getVal which pulls from the DOM.
            // Since we sync the inputs visually, the values should be consistent regardless of which tab drove them.
            
            const rfiBaseFreq = getVal('input-rfi-base-freq'); // NEW exposed input
            const rfiCriticalPct = getVal('input-rfi-critical') / 100;
            const rfiErrorPct = getVal('input-rfi-error') / 100;
            const rfiMult = getVal('input-rfi-mult');
            const rfiImprove = getVal('input-rfi-improve') / 100;

            // Baseline RFI Count
            const baseRFIs = (vol / 1000000) * rfiBaseFreq;
            
            // Critical Field RFIs = Total * %Error * %Critical
            const criticalFieldRFIs = baseRFIs * rfiErrorPct * rfiCriticalPct;
            
            // Cost per Impact = Daily Burn * Multiplier
            const costPerImpact = dailyBurn * rfiMult;
            
            // Total Exposure and Savings
            const totalRFIExposure = criticalFieldRFIs * costPerImpact;
            state.rfi = totalRFIExposure * rfiImprove;

            // UI Updates - RFI Inputs & Syncs
            // We need to update labels for the Tab 4 versions of GC/Duration
            if (document.getElementById('val-rfi-gc')) document.getElementById('val-rfi-gc').innerText = (gcPct * 100).toFixed(1) + '%';
            if (document.getElementById('val-rfi-duration')) document.getElementById('val-rfi-duration').innerText = durationMo;
            if (document.getElementById('val-rfi-base-freq')) document.getElementById('val-rfi-base-freq').innerText = rfiBaseFreq;
            
            if (document.getElementById('val-rfi-critical')) document.getElementById('val-rfi-critical').innerText = (rfiCriticalPct * 100).toFixed(0) + '%';
            if (document.getElementById('val-rfi-error')) document.getElementById('val-rfi-error').innerText = (rfiErrorPct * 100).toFixed(0) + '%';
            if (document.getElementById('val-rfi-mult')) document.getElementById('val-rfi-mult').innerText = rfiMult + 'x';
            if (document.getElementById('val-rfi-improve')) document.getElementById('val-rfi-improve').innerText = (rfiImprove * 100).toFixed(0) + '%';

            // UI Updates - Cards
            if (document.getElementById('display-rfi-savings')) document.getElementById('display-rfi-savings').innerText = toCurrency(state.rfi);
            if (document.getElementById('display-rfi-count')) document.getElementById('display-rfi-count').innerText = Math.round(criticalFieldRFIs).toLocaleString();
            if (document.getElementById('display-rfi-burden')) document.getElementById('display-rfi-burden').innerText = toCurrency(costPerImpact);

            // UI Updates - Narrative
            if (document.getElementById('narrative-rfi-error')) document.getElementById('narrative-rfi-error').innerText = (rfiErrorPct * 100).toFixed(0) + '%';
            if (document.getElementById('narrative-rfi-critical')) document.getElementById('narrative-rfi-critical').innerText = (rfiCriticalPct * 100).toFixed(0) + '%';
            if (document.getElementById('narrative-rfi-count')) document.getElementById('narrative-rfi-count').innerText = Math.round(criticalFieldRFIs).toLocaleString();
            if (document.getElementById('narrative-rfi-burn')) document.getElementById('narrative-rfi-burn').innerText = toCurrency(dailyBurn);
            if (document.getElementById('narrative-rfi-mult')) document.getElementById('narrative-rfi-mult').innerText = rfiMult + 'x';
            if (document.getElementById('narrative-rfi-cost')) document.getElementById('narrative-rfi-cost').innerText = toCurrency(costPerImpact);
            if (document.getElementById('narrative-rfi-improve')) document.getElementById('narrative-rfi-improve').innerText = (rfiImprove * 100).toFixed(0) + '%';
            if (document.getElementById('narrative-rfi-savings')) document.getElementById('narrative-rfi-savings').innerText = toCurrency(state.rfi);

            // --- Coordination Logic (UPDATED - Simplified) ---
            const coordImprove = getVal('input-coord-improve') / 100; // VDC Savings %

            // Simple Top-Down Calculation: Volume * Improvement %
            state.coordination = vol * coordImprove;

            // UI Updates - Coordination
            if (document.getElementById('val-coord-improve')) document.getElementById('val-coord-improve').innerText = (coordImprove * 100).toFixed(2) + '%';

            if (document.getElementById('display-coord-savings')) document.getElementById('display-coord-savings').innerText = toCurrency(state.coordination);
            
            // Updated secondary metrics
            if (document.getElementById('display-coord-improve-pct')) document.getElementById('display-coord-improve-pct').innerText = (coordImprove * 100).toFixed(2) + '%';
            if (document.getElementById('display-coord-val')) document.getElementById('display-coord-val').innerText = toCurrency(state.coordination);

            // Updated Narrative
            if (document.getElementById('narrative-coord-vol')) document.getElementById('narrative-coord-vol').innerText = toCurrency(vol);
            if (document.getElementById('narrative-coord-improve')) document.getElementById('narrative-coord-improve').innerText = (coordImprove * 100).toFixed(2) + '%';
            if (document.getElementById('narrative-coord-savings')) document.getElementById('narrative-coord-savings').innerText = toCurrency(state.coordination);

            // --- Bidder Selection Logic ---
            const bidLowPct = getVal('input-bid-low') / 100;
            const bidDisputePct = getVal('input-bid-dispute') / 100;
            const bidInitialPct = getVal('input-bid-initial') / 100;
            // Removed bidSettlePct
            const bidRecoverPct = getVal('input-bid-recover') / 100;
            const bidImprovePct = getVal('input-bid-improve') / 100;

            const volAtRisk = vol * bidLowPct;
            const disputeVol = volAtRisk * bidDisputePct;
            const totalDisputeValue = disputeVol * bidInitialPct;
            
            // UPDATED CALCULATION: Liability = Dispute Value * (1 - Recovery Rate)
            const settlementLiability = totalDisputeValue * (1 - bidRecoverPct);
            
            state.bidder = settlementLiability * bidImprovePct;

            // UI Updates - Bidder
            if (document.getElementById('val-bid-low')) document.getElementById('val-bid-low').innerText = (bidLowPct * 100).toFixed(0) + '%';
            if (document.getElementById('val-bid-dispute')) document.getElementById('val-bid-dispute').innerText = (bidDisputePct * 100).toFixed(0) + '%';
            if (document.getElementById('val-bid-initial')) document.getElementById('val-bid-initial').innerText = (bidInitialPct * 100).toFixed(1) + '%';
            if (document.getElementById('val-bid-recover')) document.getElementById('val-bid-recover').innerText = (bidRecoverPct * 100).toFixed(0) + '%';
            if (document.getElementById('val-bid-improve')) document.getElementById('val-bid-improve').innerText = (bidImprovePct * 100).toFixed(0) + '%';

            if (document.getElementById('display-bid-savings')) document.getElementById('display-bid-savings').innerText = toCurrency(state.bidder);
            if (document.getElementById('display-bid-exposure')) document.getElementById('display-bid-exposure').innerText = toCurrency(totalDisputeValue);
            if (document.getElementById('display-bid-liability')) document.getElementById('display-bid-liability').innerText = toCurrency(settlementLiability);

            if (document.getElementById('narrative-bid-low')) document.getElementById('narrative-bid-low').innerText = (bidLowPct * 100).toFixed(0) + '%';
            if (document.getElementById('narrative-bid-freq')) document.getElementById('narrative-bid-freq').innerText = (bidDisputePct * 100).toFixed(0) + '%';
            if (document.getElementById('narrative-bid-initial')) document.getElementById('narrative-bid-initial').innerText = toCurrency(totalDisputeValue);
            if (document.getElementById('narrative-bid-recover')) document.getElementById('narrative-bid-recover').innerText = (bidRecoverPct * 100).toFixed(0) + '%';
            if (document.getElementById('narrative-bid-settle-val')) document.getElementById('narrative-bid-settle-val').innerText = toCurrency(settlementLiability);
            if (document.getElementById('narrative-bid-improve')) document.getElementById('narrative-bid-improve').innerText = (bidImprovePct * 100).toFixed(0) + '%';
            if (document.getElementById('narrative-bid-savings')) document.getElementById('narrative-bid-savings').innerText = toCurrency(state.bidder);


            // --- Global Summary ---
            // Check toggles (if they exist, default to true)
            const sTog = document.getElementById('toggle-safety');
            const rTog = document.getElementById('toggle-rework');
            const scTog = document.getElementById('toggle-schedule');
            const rfTog = document.getElementById('toggle-rfi');
            const cTog = document.getElementById('toggle-coordination');
            const bTog = document.getElementById('toggle-bidder');
            
            const sOn = sTog ? sTog.checked : true;
            const rOn = rTog ? rTog.checked : true;
            const scOn = scTog ? scTog.checked : true;
            const rfOn = rfTog ? rfTog.checked : true;
            const cOn = cTog ? cTog.checked : true;
            const bOn = bTog ? bTog.checked : true;

            const savingsY1 = (sOn ? state.safety : 0) + (rOn ? state.rework : 0) + (scOn ? state.schedule : 0) + (rfOn ? state.rfi : 0) + (cOn ? state.coordination : 0) + (bOn ? state.bidder : 0);
            const savingsY2 = (sOn ? state.safety * 1.1 : 0) + (rOn ? state.rework * 1.1 : 0) + (scOn ? state.schedule * 1.1 : 0) + (rfOn ? state.rfi * 1.1 : 0) + (cOn ? state.coordination * 1.1 : 0) + (bOn ? state.bidder * 1.1 : 0);
            const savingsY3 = (sOn ? state.safety * 1.25 : 0) + (rOn ? state.rework * 1.25 : 0) + (scOn ? state.schedule * 1.25 : 0) + (rfOn ? state.rfi * 1.25 : 0) + (cOn ? state.coordination * 1.25 : 0) + (bOn ? state.bidder * 1.25 : 0);

            // Investments
            const investAnnual = getVal('input-invest-annual');
            const investOneTime = getVal('input-invest-onetime');
            
            const costY1 = investAnnual + investOneTime;
            const costY2 = investAnnual;
            const costY3 = investAnnual;

            // Calculate ROI % = ((Return - Cost) / Cost) * 100
            // Guard against divide by zero
            const roiY1 = costY1 > 0 ? ((savingsY1 - costY1) / costY1) * 100 : 0;
            const roiY2 = costY2 > 0 ? ((savingsY2 - costY2) / costY2) * 100 : 0;
            const roiY3 = costY3 > 0 ? ((savingsY3 - costY3) / costY3) * 100 : 0;

            state.roi = [roiY1, roiY2, roiY3];

            const y1 = savingsY1; // For display on card
            
            if (document.getElementById('summary-total-savings')) document.getElementById('summary-total-savings').innerText = toCurrency(y1);
            if (document.getElementById('summary-roi-y1')) document.getElementById('summary-roi-y1').innerText = roiY1.toFixed(0) + '%';
            if (document.getElementById('summary-total-3yr')) document.getElementById('summary-total-3yr').innerText = toCurrency(savingsY1 + savingsY2 + savingsY3);
        }

        function renderChart() {
            const canvas = document.getElementById('roiChart');
            if (!canvas) return; // Guard clause
            
            const ctx = canvas.getContext('2d');
            if (roiChart) roiChart.destroy();

            // Check toggles
            const sTog = document.getElementById('toggle-safety');
            const rTog = document.getElementById('toggle-rework');
            const scTog = document.getElementById('toggle-schedule');
            const rfTog = document.getElementById('toggle-rfi');
            const cTog = document.getElementById('toggle-coordination');
            const bTog = document.getElementById('toggle-bidder');
            
            const sOn = sTog ? sTog.checked : true;
            const rOn = rTog ? rTog.checked : true;
            const scOn = scTog ? scTog.checked : true;
            const rfOn = rfTog ? rfTog.checked : true;
            const cOn = cTog ? cTog.checked : true;
            const bOn = bTog ? bTog.checked : true;

            // Prepare datasets conditionally
            const datasets = [];
            
            // ROI Line (Right Axis) - Added First so it renders on top if using 'order' property, 
            // but chart.js renders datasets in order. Lines usually render on top of bars automatically if mixed.
            datasets.push({
                type: 'line',
                label: 'ROI %',
                data: state.roi,
                borderColor: '#1A1A1A',
                borderWidth: 3,
                pointBackgroundColor: '#1A1A1A',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 6,
                yAxisID: 'y1',
                order: 0 // Render on top
            });

            if (sOn) {
                // Safety: Orange
                datasets.push({ 
                    label: 'Incident Reduction', 
                    data: [state.safety, state.safety * 1.1, state.safety * 1.25], 
                    backgroundColor: '#D95D2A', 
                    borderRadius: 6,
                    yAxisID: 'y',
                    order: 1
                });
            }
            if (rOn) {
                // Rework: Black
                datasets.push({ 
                    label: 'Rework Reduction', 
                    data: [state.rework, state.rework * 1.1, state.rework * 1.25], 
                    backgroundColor: '#1A1A1A', 
                    borderRadius: 6,
                    yAxisID: 'y',
                    order: 1
                });
            }
            if (scOn) {
                // Schedule: Tan
                datasets.push({ 
                    label: 'GC Overrun Reduction', 
                    data: [state.schedule, state.schedule * 1.1, state.schedule * 1.25], 
                    backgroundColor: '#EAE3D9', 
                    borderRadius: 6,
                    yAxisID: 'y',
                    order: 1
                });
            }
            if (rfOn) {
                // RFI: #8d6e5b
                datasets.push({ 
                    label: 'RFI Response Reduction', 
                    data: [state.rfi, state.rfi * 1.1, state.rfi * 1.25], 
                    backgroundColor: '#8d6e5b', 
                    borderRadius: 6,
                    yAxisID: 'y',
                    order: 1
                });
            }
            if (cOn) {
                // Coordination: #cec4a1
                datasets.push({ 
                    label: 'Coordination Improvement', 
                    data: [state.coordination, state.coordination * 1.1, state.coordination * 1.25], 
                    backgroundColor: '#cec4a1', 
                    borderRadius: 6,
                    yAxisID: 'y',
                    order: 1
                });
            }
            if (bOn) {
                // Bidder: #566578
                datasets.push({ 
                    label: 'Bidder Selection Improvement', 
                    data: [state.bidder, state.bidder * 1.1, state.bidder * 1.25], 
                    backgroundColor: '#566578', 
                    borderRadius: 6,
                    yAxisID: 'y',
                    order: 1
                });
            }

            roiChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Year 1', 'Year 2', 'Year 3'],
                    datasets: datasets
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: { 
                        x: { stacked: true }, 
                        y: { 
                            type: 'linear',
                            display: true,
                            position: 'left',
                            stacked: true, 
                            ticks: { callback: (v) => toShort(v) },
                            title: { display: true, text: 'Realized Savings ($)' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false, // only want the grid lines for one axis to show up
                            },
                            ticks: { callback: (v) => v.toFixed(0) + '%' },
                            title: { display: true, text: 'Return on Investment (%)' }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.dataset.type === 'line') {
                                        label += Math.round(context.raw) + '%';
                                    } else {
                                        label += toCurrency(context.raw);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.querySelectorAll('input').forEach(i => i.addEventListener('input', calculate));
        window.onload = () => { lucide.createIcons(); calculate(); };
    </script>
</body>
</html>
